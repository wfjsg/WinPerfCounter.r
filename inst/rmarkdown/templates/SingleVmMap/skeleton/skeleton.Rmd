---
title: "SimpleSystemSummary"
author: "WataruFujishige"
date: "2017/12/31"
output: html_document
params:
  csvfile: "../../../../../tests/testthat/rstudio.csv"
---

```{r setup, include=FALSE}
library(WinPerfCounter)
library(readr)
library(ggplot2)
library(ggthemes)
library(cowplot)
library(formattable)
library(gtable)
library(gridExtra)
library(grid)
library(tibble)
library(knitr)
library(kableExtra)
time.lap = list()
time.lap <- c(time.lap, list(first = proc.time()))

filename <- params$csvfile

filename <- "../../../../../tests/testthat/rstudio.csv"
header <- VMMap.read.header(filename)
body <- VMMap.read.body(params$csvfile)
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, fig.width=12, fig.height=8)
time.lap <- c(time.lap, list(RawReadFromCSV = proc.time()))

```

***

# Summary

```{r}
header %>% 
  kable("html") %>%  
  kable_styling(bootstrap_options = c("striped", "hover")) %>% 
  row_spec(2, background = "#D8ADFF") %>% 
  row_spec(3, background = "#B0D7FF") %>% 
  row_spec(4, background = "#DDEEFF") %>% 
  row_spec(5, background = "#FF9664") %>% 
  row_spec(6, background = "#D4E27A") %>% 
  row_spec(7, background = "#FFC080") %>% 
  row_spec(8, background = "#F4F400") %>% 
  row_spec(9, background = "#D2A0A0") %>% 
  row_spec(10, background = "#D2D2D2")

```


***



***

# Report Self

```{r}
time.lap <- c(time.lap, list(Plotting = proc.time()))

time.lap.df.tmp <- as.data.frame(
  t(
    data.frame(purrr::map(time.lap, ~ c(.["user.self"], .["sys.self"], .["elapsed"])))))
time.lap.viz <- time.lap.df.tmp %>% rownames_to_column(var = "Stage") %>% dplyr::mutate(
  user.self = user.self - lag(user.self, default = 0),
  sys.self  = sys.self - lag(sys.self, default = 0),
  elapsed   = elapsed - lag(elapsed, default = 0)) %>% dplyr::filter(Stage != "first");

formattable(time.lap.viz, list(
  user.self = color_bar("azure1"),
  sys.self = color_bar("azure2"),
  elapsed = color_bar("azure4")
))
```
